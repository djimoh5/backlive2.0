var Home={init:function(){Home.adjustHeaderHeight();$(window).resize(function(){Home.adjustHeaderHeight()});$("#invite input, #invite textarea").keyup(function(e){Home.enterCapture(".btn-req-invite",e)});$("#txt_uname").keyup(function(e){Home.enterCapture(".btn-login",e)});$("#txt_pword").keyup(function(e){Home.enterCapture(".btn-login",e)});$("#txt_reg_uname").keyup(function(e){Home.enterCapture(".btn-register",e)});$("#txt_reg_pword").keyup(function(e){Home.enterCapture(".btn-register",e)});$("#txt_reg_email").keyup(function(e){Home.enterCapture(".btn-register",e)});$(".btn-signin").click(function(){if($(".sign-in-menu").is(":visible"))$(this).parent().removeClass("open");else $(this).parent().addClass("open");$(".btn-show-register").parent().removeClass("open");$("#txt_uname").focus()});$(".btn-show-register").click(function(){if($(".register-menu").is(":visible"))$(this).parent().removeClass("open");else $(this).parent().addClass("open");$(".btn-signin").parent().removeClass("open");$("#txt_reg_uname").focus()});$(".dropdown-menu .login-form").click(function(e){e.stopPropagation()});var e=[];Home.api({ticker:"SP500",years:1},"data/prices",function(t){var n,r;for(var i=0,s=t.length;i<s;i++){var o=t[i].adjClose;e.push([parseDate(t[i].date,3).getTime(),o]);if(!n||o<n)n=o;else if(!r||o>r)r=o}Home.initChart(e,n,r)});$("#video_modal").on("hide.bs.modal",function(e){$("#video_modal .modal-content").empty()})},showRegister:function(){$(".btn-show-register").click();window.location.href="#index";$("#pricing .exit-invite a").click()},adjustHeaderHeight:function(){var e=$(window).height();$(".header").height(e-80);var t=60,n=300,r=554,i;var s=e-(r+93);if(s>=t){i=0;if(s>200)s=Math.max(t,(e-r)/2-93)}else{i=t-s;s=t}$(".intro-text").css("margin-top",s);$(".screenshot-container .inner").css("height",n-i);$(".screenshot-container .middle .inner").css("height",n+70-i);$(".screenshot-container .middle .inner .overlay").css("line-height",n+70-i+"px")},login:function(){$(".sign-in-menu .error-msg").hide();Home.api({uname:$("#txt_uname").val(),pword:$("#txt_pword").val()},"user/login",function(e){if(e.error)$(".sign-in-menu .error-msg").show().html("username or password incorrect");else Home.loginSuccess(e)})},register:function(){if($('.accept-terms input[type="checkbox"]').is(":checked")){$(".register-menu .error-msg").hide();var e=Home.formValue("#txt_reg_uname","must be greater than 4 chars");var t=Home.emailValue("#txt_reg_email");var n=Home.formValue("#txt_reg_pword","must be greater than 4 chars");if(e!=null&&t!=null&&n!=null){Home.api({uname:e,pword:n,email:t},"user/register",function(e){console.log(e);if(e.error)$(".register-menu .error-msg").show().html(e.error);else{Home.sendWelcomeEmail(t);setTimeout(function(){Home.loginSuccess(e)},1e3)}})}}else{$(".register-menu .error-msg").show().html("please accept the terms of service to continue")}},forgotPassword:function(){$(".sign-in-menu .error-msg").hide();var e=Home.formValue("#txt_uname","username required");if(e!=null){Home.api({uname:e},"user/forgotpassword",function(t){if(!t.success)$(".sign-in-menu .error-msg").show().html(t.msg);else{$(".sign-in-menu .error-msg").show().html("your new password will be emailed to you");var n=[{email:t.e,type:"to"}];var r="Your temporary password: "+t.pw+"<br/><br/>Please remember to change it after signing in (click settings icon in upper right of site).";$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send-template.json",data:{key:"oweoS4RQJE2pOx2s8MXVhQ",template_name:"backlive-main-template",template_content:[{name:"header",content:"Hi "+e+","},{name:"main",content:r},{name:"main-left",content:""},{name:"main-right",content:""},{name:"action-button",content:"Sign-in to BackLive"}],message:{to:n,subject:"BackLive Temporary Password",merge_vars:[{rcpt:t.e,vars:[{name:"LINK_ACTION",content:""}]}]}}}).done(function(e){$(".sign-in-menu .error-msg").show().html("your new password has been emailed to you")}).fail(function(e){console.log(e);$(".sign-in-menu .error-msg").show().html("Failed to email new password, please contact BackLive")})}})}},loginSuccess:function(e){var t=new Date;if(e.tr_r)t.setFullYear(2020);else t.setFullYear(2e3);document.cookie="bl_tour=1; expires="+t.toString()+"; path=/";if(e.tr_b)t.setFullYear(2020);else t.setFullYear(2e3);document.cookie="bl_bt_tour=1; expires="+t.toString()+"; path=/";window.location.reload()},requestInvite:function(){var e={action:"invite",name:Home.formValue('#invite input[name="name"]',"first and last name required"),email:Home.emailValue('#invite input[name="email"]'),co:$('#invite input[name="company"]').val(),info:$("#invite textarea").val()};if(e.name!=null&&e.email!=null){$("#invite .main-form").addClass("hide");$("#invite .thankyou").removeClass("hide");Home.api(e,"contactus",function(e){console.log(e)});var t=[{email:"deji@backlivelabs.com",type:"to"},{email:"eli@backlivelabs.com",type:"to"},{email:"craig@backlivelabs.com",type:"to"}];var n="name: "+e.name+"\nemail: "+e.email+"\ncompany: "+e.co+"\ninfo: "+e.info;var r='<div style="font-size:15px;color:#eee;padding:20px;background:#12455a;border-radius:10px;"><img src="https://backlive.io/home/images/logo.png" style="display:block;width:170px;margin:0 auto 15px auto;" /><br/>'+n.replace(/\n/g,"<br/>")+"</div>";$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send.json",data:{key:"oweoS4RQJE2pOx2s8MXVhQ",message:{from_email:e.email,from_name:e.name,headers:{"Reply-To":e.email},subject:"BackLive Invite Request",to:t,html:r,text:n}}})}},playVideo:function(){$("#video_modal").modal("show");$("#video_modal .modal-content").html('<iframe src="//player.vimeo.com/video/107407701?autoplay=1" width="960" height="540" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>');mixpanel.track("animoto video")},learnMore:function(){$("html,body").animate({scrollTop:$(".features-container").offset().top})},initChart:function(e,t,n){Home.chart=new Highcharts.StockChart({chart:{renderTo:"chart",type:"areaspline",backgroundColor:null,animation:{duration:6e3,easing:"swing"},zoomType:"x",events:{load:function(){setTimeout(function(){Home.chart.yAxis[0].setExtremes(t,n)},3500);setTimeout(function(){$("#chart").fadeOut(7e3)},1e4)}}},title:{text:""},rangeSelector:{selected:5,enabled:false},navigator:{enabled:false},xAxis:{lineWidth:0,minorGridLineWidth:0,minorTickLength:0,tickLength:0,labels:{enabled:false}},yAxis:[{gridLineColor:"transparent",labels:{enabled:false}}],series:[{name:"S&P 500",yAxis:0,data:e,color:"#1B3946"}],credits:{enabled:false},legend:{enabled:false},scrollbar:{enabled:false},plotOptions:{series:{lineWidth:2,shadow:{color:"#888888",offsetX:2,offsetY:2,opacity:.2,width:3},animation:{duration:4e3,easing:"swing"}},areaspline:{fillOpacity:.1}},tooltip:{backgroundColor:"transparent",shared:false,formatter:function(){return'<span style="font-size:10px;color:#eee;">'+Highcharts.dateFormat("%A, %b %e, %Y",this.x)+'</span><br/><span style="color:#5f97a9">'+this.series.name+': </span> <span style="color:#eee"> '+this.y+"</span>"}}})},pageView:function(e){ga("send","pageview",{page:"/"+e,title:"BackLive "+e.ucfirst()})},api:function(e,t,n,r){Home.ajax(e,"/api/"+t,function(e){n(JSON.parse(e))},r)},ajax:function(e,t,n,r){var i=r?false:true;var e;if(e!=null)e={data:encodeURIComponent(JSON.stringify(e))};else e={};$.ajax({cache:false,async:i,url:t,dataType:"text",beforeSend:function(e){},complete:function(e,t){},data:e,success:n,error:function(e,t,r){n(null)}})},sendContactUs:function(){var e=Home.formValue('#contactus_modal input[name="email"]',"your email must be in form abs@xyz.com",false,true);var t=Home.formValue('#contactus_modal input[name="name"]',"your name is required");var n=Home.formValue("#contactus_modal textarea","a message is required");var r='<div style="font-size:15px;color:#eee;padding:20px;background:#12455a;border-radius:10px;"><img src="https://backlive.io/home/images/logo.png" style="display:block;width:170px;margin:0 auto 15px auto;" /><br/>'+n+"</div>";if(t&&n){var i=[{email:"deji@backlivelabs.com",type:"to"},{email:"craig@backlivelabs.com",type:"to"}];$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send.json",data:{key:"oweoS4RQJE2pOx2s8MXVhQ",message:{from_email:e,from_name:t,headers:{"Reply-To":e},subject:"BackLive Contact Us",to:i,html:r,text:n}}}).done(function(e){$("#contactus_modal .error").html("Your message has been sent. Thank you.").show();$('#mandrill-email-form input[name="email"]').val("");$('#mandrill-email-form input[name="name"]').val("");$('#mandrill-email-form textarea[name="msg"]').val("")}).fail(function(e){$("#contactus_modal .error").html("an uexpected error occurred, please try again").show()})}},showContactUs:function(){$("#contactus_modal .error").hide().empty();$("#contactus_modal").modal("show")},sendWelcomeEmail:function(e){var t=[{email:e,type:"to"},{email:"deji@backlivelabs.com",type:"bcc"},{email:"craig@backlivelabs.com",type:"bcc"}];$.ajax({type:"POST",url:"https://mandrillapp.com/api/1.0/messages/send-template.json",data:{key:"oweoS4RQJE2pOx2s8MXVhQ",template_name:"welcome-email",template_content:[{name:"",content:""}],message:{to:t}}}).done(function(e){}).fail(function(e){console.log(e)})},enterCapture:function(e,t){if(!t)t=window.event;var n=$(e);var r=t.keyCode?t.keyCode:t.which;if(r==13){t.preventDefault();n.focus();n.click()}},formError:function(e,t,n,r){$(e).addClass("form-error").val(t).blur();$(e).off("focus").on("focus",function(){$(this).removeClass("form-error").val(r?r:"").off("focus")});if(n)$("html, body").animate({scrollTop:$(e).offset().top-30},300)},formValue:function(e,t,n,r){if($(e).val()&&$(e).val().length>0&&!$(e).hasClass("form-error")&&(!r||validEmail($(e).val())))return $(e).val();else{Home.formError(n?n:e,t);return null}},emailValue:function(e){var t=/^([a-zA-Z0-9_.-])+@([a-zA-Z0-9_.-])+\.([a-zA-Z])+([a-zA-Z])+/;if(t.test($(e).val()))return $(e).val();else{Home.formError(e,"must be in form abs@xyz.com");return null}}}